<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script type="text/javascript" src="http://vmphone2.cs.berkeley.edu/jquery-1.5.1.min.js"></script>
<script language="Javascript">
//
// This method Gets URL Parameters (GUP)
//
function gup( name )
{
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var tmpURL = window.location.href;
  var results = regex.exec( tmpURL );
  if( results == null )
    return "";
  else
    return results[1];
}

var count = 0;
var result = [];

function changeText(node, text){
	node.removeChild(node.firstChild);
        pre = document.createElement('pre');
        pre.appendChild(document.createTextNode(text));
        node.appendChild(pre);
}

function ajaxSuccess(data, textStatus, jqXHR){
	changeText(document.getElementById('professor'), professor);
	changeText(document.getElementById('question'), question);
	current_image = 0;
	document.getElementById("student").src = students[current_image];
	var i = 0;
	while (i <= max_grade){
		option = document.createElement('option');
		option.appendChild(document.createTextNode(i+''));
		document.getElementById('grade').appendChild(option);
		i = i + 1;
	}
}

function nextImage(){
	document.getElementById('result').value += (document.getElementById('grade').options[document.getElementById('grade').selectedIndex].text) + ",";
	current_image += 1;
	document.getElementById("student").disabled = true;
	if (current_image < students.length){
		document.getElementById("student").src = students[current_image];
		document.getElementById('grade').selectedIndex = 0;
	}
	else {
		document.getElementById('form_items').removeChild(document.getElementById('grade'));
		document.getElementById('turk_form').submit();
	}
	document.getElementById("student").disabled = false;
}
//
// This method decodes the query parameters that were URL-encoded
//
function decode(strToDecode)
{
  var encoded = strToDecode;
  return unescape(encoded.replace(/\+/g,  " "));
}

</script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Umati-Mturk</title>
</head>

<body>
<table width="800" border="0">
  <tr>
    <td>
      <h1>
	<p>AFTER SUBMITTING A GRADE, MAKE SURE THE NEXT IMAGE LOADS COMPLETELY! The images are big, they sometimes take a little bit.</p>
      </h1>
      <h2>
	<p>INSTRUCTIONS:</P
	<p>Grade this particular exam question.</p> 
	<p>The first area (Green) is the question given to the student. The second area (Orange) is the professor's example answer. The last area (Yellow) is a scan of the student's answer. Please do your best to grade the question appropriately at the bottom of the screen. There are between 5 and 10 student answers to each question.</p>
      </h2>
    </td>
  </tr>
  <tr>
    <td bgcolor="#00FF66"><h4 id="question">Question: %d</h2></td>
  </tr>
  <tr>
    <td bgcolor="#FF6600"><h4 id="professor">Professor's Answer: %d</h2></td>
  </tr>
  <tr>
    <td bgcolor="#CCFF33"><img id="student" width="100%"/></td>
  </tr>
  <tr>
    <td align="right"><form id="turk_form" name="turk_form" method="POST" action="http://www.mturk.com/mturk/externalSubmit">
	    <input type="hidden" id="assignmentId" name="assignmentId" value="">
        <input type="hidden" id="result" name="result" value="">
      <h3 id="form_items" >Grade:
        <select name="grade" id="grade">
        </select>
        <input id="next" name="next" type="button" value="Submit" onclick="nextImage();"/>
      </h3>
    </form></td>
  </tr>
</table>
<script language="Javascript">
	var res = $.get(decode(gup('url')));
	document.getElementById('assignmentId').value = gup('assignmentId');
	res.success(ajaxSuccess);
	
    //
    // Check if the worker is PREVIEWING the HIT or if they've ACCEPTED the HIT
    //
    if (gup('assignmentId') == "ASSIGNMENT_ID_NOT_AVAILABLE")
    {
  // If we're previewing, disable the button and give it a helpful message
  document.getElementById('next').disabled = true;
  document.getElementById('next').value = "You must ACCEPT the HIT first";
    } else {
        var form = document.getElementById('turk_form');
        if (document.referrer && ( document.referrer.indexOf('workersandbox') != -1) ) {
            form.action = "http://workersandbox.mturk.com/mturk/externalSubmit";
        }
    }

</script>
</body>
</html>
